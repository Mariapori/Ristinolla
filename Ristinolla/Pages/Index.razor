@using Ristinolla.Data
@page "/"

<PageTitle>Ristinolla</PageTitle>
@if(ruudut != null)
{
    <div id="peli">
    @foreach(var ruutu in ruudut)
    {
        <div class="ruudukko" @key="ruutu.Id" @onclick="() => ValitseRuutu(ruutu)">@ruutu.Pelaaja</div>
    }
</div>
    @if(voittaja != null)
    {
        <div class="voittaja">
            <h2>Voittaja: @voittaja</h2>
        </div>
    }
}



@code{
    private List<Ruutu>? ruudut;
    private string? pelaaja = "X";
    private string? voittaja;

    protected override void OnInitialized()
    {
        ruudut = new List<Ruutu>();
        for(int i = 0; i < 9; i++)
        {
            ruudut.Add(new Ruutu { Id = i, Pelaaja = null });
        }
    }

    public void ValitseRuutu(Ruutu valittu)
    {
        if(valittu.Pelaaja == null && voittaja == null)
        {
            valittu.Pelaaja = pelaaja;
            Voittiko();
            if(pelaaja == "X")
            {
                pelaaja = "0";
            }
            else
            {
                pelaaja = "X";
            }
        }

    }

    public bool Voittiko()
    {
        if (ruudut != null && ruudut.Where(o => o.Pelaaja != null).Count() > 3)
        {
            var ruudutArray = ruudut.ToArray();
            int[,] voittolinjat = { { 0, 1, 2 }, { 3, 4, 5 }, { 6, 7, 8 }, { 0, 3, 6 }, { 1, 4, 7 }, { 2, 5, 8 }, { 0, 4, 8 }, { 2, 4, 6 } };
            for(int i = 0; i < 8; i++)
            {
                var a = ruudutArray[voittolinjat[i,0]].Pelaaja ?? "A";
                var b = ruudutArray[voittolinjat[i,1]].Pelaaja ?? "B";
                var c = ruudutArray[voittolinjat[i,2]].Pelaaja ?? "C";
                if(a == b && c == a)
                {
                    voittaja = pelaaja;
                    return true;
                }
            }
            if(ruudut.Where(o => o.Pelaaja != null).Count() == 9 && voittaja == null)
            {
                voittaja = "Tasapeli";
            }
            return false;
        }
        else
        {
            return false;
        }
    }

}